<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Caixa Inteligente PRO Cloud</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{
    font-family:Arial;
    background:#0f172a;
    color:#fff;
    margin:0;
    padding:20px;
}
h1{color:#00ff88;}
.card{
    background:#1e293b;
    padding:15px;
    border-radius:10px;
    margin:15px 0;
}
input,select,button{
    padding:8px;
    margin:5px;
    border-radius:6px;
    border:none;
}
button{
    background:#00ff88;
    font-weight:bold;
    cursor:pointer;
}
.dashboard{
    display:grid;
    grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
    gap:10px;
}
.metric{
    background:#334155;
    padding:15px;
    border-radius:8px;
}
canvas{
    background:#fff;
    border-radius:8px;
}
</style>
</head>
<body>

<h1>ğŸ’° Caixa Inteligente PRO Cloud</h1>

<div class="card">
<h2>ğŸ” Login</h2>
<input id="email" placeholder="Email">
<input id="senha" type="password" placeholder="Senha">
<button onclick="registrar()">Registrar</button>
<button onclick="login()">Entrar</button>
</div>

<div class="card">
<h2>ğŸ“¦ Produto</h2>
<input id="nomeProduto" placeholder="Nome">
<input id="precoProduto" type="number" placeholder="PreÃ§o">
<input id="custoProduto" type="number" placeholder="Custo">
<button onclick="salvarProduto()">Salvar</button>
</div>

<div class="card">
<h2>ğŸ›’ Venda</h2>
<input id="produtoVenda" placeholder="Nome do Produto">
<input id="valorVenda" type="number" placeholder="Valor">
<button onclick="salvarVenda()">Salvar Venda</button>
</div>

<div class="card">
<h2>ğŸ“‰ Despesa</h2>
<input id="descricaoDespesa" placeholder="DescriÃ§Ã£o">
<input id="valorDespesa" type="number" placeholder="Valor">
<button onclick="salvarDespesa()">Salvar Despesa</button>
</div>

<div class="card">
<h2>ğŸ“Š Dashboard</h2>
<div class="dashboard">
<div class="metric">Faturamento<br><b id="fat">R$ 0</b></div>
<div class="metric">Lucro Bruto<br><b id="lucroBruto">R$ 0</b></div>
<div class="metric">Despesas<br><b id="despesasTot">R$ 0</b></div>
<div class="metric">Lucro LÃ­quido<br><b id="lucroLiquido">R$ 0</b></div>
</div>
</div>

<div class="card">
<h2>ğŸ“ˆ Faturamento por Dia</h2>
<canvas id="grafico"></canvas>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCeZGx81bH8fe0XimE_1Gu4agejGPzWQ8A",
  authDomain: "caixa-inteligente-f2d23.firebaseapp.com",
  projectId: "caixa-inteligente-f2d23",
  storageBucket: "caixa-inteligente-f2d23.firebasestorage.app",
  messagingSenderId: "685162507832",
  appId: "1:685162507832:web:716647160f381d96d8c0cd"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// LOGIN
window.registrar = async () => {
  await createUserWithEmailAndPassword(auth,email.value,senha.value);
  alert("UsuÃ¡rio criado!");
}

window.login = async () => {
  await signInWithEmailAndPassword(auth,email.value,senha.value);
  alert("Login realizado!");
}

// PRODUTO
window.salvarProduto = async () => {
  await addDoc(collection(db,"produtos"),{
    nome:nomeProduto.value,
    preco:parseFloat(precoProduto.value),
    custo:parseFloat(custoProduto.value),
    data:new Date()
  });
  alert("Produto salvo!");
}

// VENDA
window.salvarVenda = async () => {
  await addDoc(collection(db,"vendas"),{
    produto:produtoVenda.value,
    valor:parseFloat(valorVenda.value),
    data:new Date()
  });
  atualizarDashboard();
}

// DESPESA
window.salvarDespesa = async () => {
  await addDoc(collection(db,"despesas"),{
    descricao:descricaoDespesa.value,
    valor:parseFloat(valorDespesa.value),
    data:new Date()
  });
  atualizarDashboard();
}

// DASHBOARD
let chart;

async function atualizarDashboard(){

  const vendasSnap = await getDocs(collection(db,"vendas"));
  const despesasSnap = await getDocs(collection(db,"despesas"));
  const produtosSnap = await getDocs(collection(db,"produtos"));

  let faturamento=0;
  let despesas=0;
  let lucroBruto=0;
  let vendasPorDia={};
  let mapaCustos={};

  produtosSnap.forEach(doc=>{
    mapaCustos[doc.data().nome]=doc.data().custo;
  });

  vendasSnap.forEach(doc=>{
    let v=doc.data();
    faturamento+=v.valor;
    let custo=mapaCustos[v.produto]||0;
    lucroBruto+= (v.valor - custo);

    let dia=new Date(v.data.seconds*1000).toLocaleDateString();
    vendasPorDia[dia]=(vendasPorDia[dia]||0)+v.valor;
  });

  despesasSnap.forEach(doc=>{
    despesas+=doc.data().valor;
  });

  let lucroLiquido=lucroBruto-despesas;

  fat.innerText="R$ "+faturamento.toFixed(2);
  lucroBruto.innerText="R$ "+lucroBruto.toFixed(2);
  despesasTot.innerText="R$ "+despesas.toFixed(2);
  lucroLiquido.innerText="R$ "+lucroLiquido.toFixed(2);

  gerarGrafico(vendasPorDia);
}

function gerarGrafico(dados){
  let labels=Object.keys(dados);
  let valores=Object.values(dados);

  if(chart) chart.destroy();

  chart=new Chart(grafico,{
    type:"bar",
    data:{
      labels:labels,
      datasets:[{label:"Faturamento",data:valores}]
    }
  });
}

atualizarDashboard();

</script>

</body>
</html>